"0","if (!require(""jsonlite"")) install.packages(""jsonlite"")"
"0","library(jsonlite)"
"0","#################################################################################"
"0","####            function - search news article with API                      ####"
"0","nytime = function (keyword,year) {"
"0","  searchQ = URLencode(keyword)"
"0","  url = paste('http://api.nytimes.com/svc/search/v2/articlesearch.json?q=',searchQ,"
"0","              '&begin_date=',year,'0101&end_date=',year,'1231&api-key=',api,sep="""")"
"0","  #get the total number of search results"
"0","  initialsearch = fromJSON(url,flatten = T)"
"0","  maxPages = round((initialsearch$response$meta$hits / 10)-1)"
"0","  "
"0","  #try with the max page limit at 10"
"0","  maxPages = ifelse(maxPages >= 20, 20, maxPages)"
"0","  "
"0","  #creat a empty data frame"
"0","  df = data.frame(id=as.numeric(),created_time=character(),snippet=character(),"
"0","                  headline=character(),news_desk = character())"
"0","  "
"0","  #save search results into data frame"
"0","  for(i in 0:maxPages){"
"0","    #get the search results of each page"
"0","    nytSearch = fromJSON(paste0(url, ""&page="", i), flatten = T) "
"0","    temp = data.frame(id=1:nrow(nytSearch$response$docs),"
"0","                      created_time = nytSearch$response$docs$pub_date,"
"0","                      snippet = nytSearch$response$docs$snippet,"
"0","                      headline = nytSearch$response$docs$headline.main,"
"0","                      news_desk = nytSearch$response$docs$news_desk)"
"0","    df=rbind(df,temp)"
"0","    Sys.sleep(5) #sleep for 5 second"
"0","  }"
"0","  return(df)"
"0","}"
